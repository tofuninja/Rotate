package com.example.rotate;

import android.content.Context;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Matrix;
import android.graphics.Paint;
import android.renderscript.Matrix2f;
import android.util.Log;
import android.view.View;

public class gameView extends View 
{
	private Bitmap pipe;
	private Bitmap pipe_b;
	
	private int gameWidth;
	private int gameHeight;
	
	private int[][] rotations; 
	private int[][] types; 
	public gameView(Context context) 
	{
		super(context);
		pipe = BitmapFactory.decodeResource(getResources(), R.drawable.pipe);
		pipe_b = BitmapFactory.decodeResource(getResources(), R.drawable.pipe_b);
		pipe.setDensity(Bitmap.DENSITY_NONE);
		pipe_b.setDensity(Bitmap.DENSITY_NONE);
		setGameSize(5,10);
		p.setColor(Color.BLACK);
	}
	
	public void setGameSize(int w, int h)
	{
		gameWidth = w;
		gameHeight = h;
		rotations = new int[w][h];
		types = new int[w][h];
	}

	
	private Matrix m = new Matrix();
	private Paint p = new Paint();
	
	@Override
	protected void onDraw(Canvas g) 
	{
		// TODO Auto-generated method stub
		super.onDraw(g);
		int w = g.getWidth();
		int h = g.getHeight()-10;
		g.setDensity(Bitmap.DENSITY_NONE);
		
		float x_spacing = (float)w/(float)gameWidth;
		float y_spacing = (float)h/(float)gameHeight;
		
		for(int i = 0; i < gameWidth; i++)
		{
			for(int j = 0; j < gameHeight; j++)
			{
				int r = rotations[i][j];
				int t = types[i][j];
				Bitmap b = pipe;
				if(t == 1) b = pipe_b;
				m.set(null);
				m.setRotate(90*r, b.getWidth()/2.0f, b.getHeight()/2.0f);
				m.setScale(x_spacing/b.getWidth(), y_spacing/b.getHeight());
				g.setMatrix(m);
				g.drawBitmap(b, i*b.getWidth(), j*b.getHeight()+50, null);

			}
		}
		
		g.drawText("w" + w + "h" + h + "xs"+ x_spacing + "ys" + y_spacing+ "    pw" + pipe.getWidth() + "     ph" + pipe.getHeight(),20,20,p);
		
	}
}
